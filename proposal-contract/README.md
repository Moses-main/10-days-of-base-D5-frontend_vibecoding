## Foundry

**Foundry is a blazing fast, portable and modular toolkit for Ethereum application development written in Rust.**

Foundry consists of:

- **Forge**: Ethereum testing framework (like Truffle, Hardhat and DappTools).
- **Cast**: Swiss army knife for interacting with EVM smart contracts, sending transactions and getting chain data.
  - **Anvil**: Local Ethereum node, akin to Ganache, Hardhat Network.
  - **Chisel**: Fast, utilitarian, and verbose solidity REPL.

# proposal-contract — Onchain Voting Contracts (Foundry)

This folder contains the smart contracts and tests for the Base Voting dApp. It is a Foundry (Forge) workspace centered around the `VotingContract`, a minimal proposal-and-vote mechanism with an owner-managed allowlist of proposers.

## Folder Structure

- `src/`
  - `VotingContract.sol` — main contract implementing proposals, voting, closing, proposer allowlist, and events.
- `test/` — Foundry tests (add more unit and fuzz tests as needed).
- `lib/` — External dependencies (e.g., `forge-std`).
- `script/` — Optional deployment scripts (not required for this minimal template).
- `out/`, `cache/` — Build artifacts generated by Forge (ignored in VCS).

## Contract Architecture

Contract: `VotingContract`

- Storage:
  - `Proposal[] public proposals` — dynamic list of proposals.
  - `mapping(uint256 => mapping(address => bool)) public hasVoted` — one-vote-per-address tracking per proposal id.
  - `mapping(address => bool) public isApprovedProposer` — allowlist for who can create proposals.
  - `address public owner` — contract owner who manages the allowlist.

- Proposal fields:
  - `description` (string) — human-readable summary.
  - `yesVotes` / `noVotes` (uint256) — tallies.
  - `active` (bool) — whether voting is still open.
  - `endTime` (uint256) — UNIX timestamp deadline (exclusive: voting allowed while `block.timestamp < endTime`).
  - `approved` (bool) — final outcome set on close when `yesVotes > noVotes`.

- Access Control:
  - `onlyOwner` — restricts allowlist admin functions.
  - `onlyApprovedProposer` — restricts proposal creation.

- Key Functions:
  - `approveProposal(address _proposer)` / `removeProposal(address _proposer)` — owner updates proposer allowlist.
  - `createProposal(string _description, uint256 _duration)` — approved proposers can create an active proposal that stays open for `_duration` seconds.
  - `vote(uint256 _proposalId, bool _vote)` — any address can vote yes/no once while active and before the deadline.
  - `closeProposal(uint256 _proposalId)` — callable by anyone after the deadline; marks `active=false` and sets `approved=true` if `yesVotes > noVotes`.
  - Views: `getProposals(uint256)` returns proposal fields; `getProposalCount()` returns total.

- Events:
  - `ProposalCreated(uint256 id, string description, uint256 endTime)`
  - `VoteCast(uint256 id, address voter)`
  - `ProposalClosed(uint256 id, bool approved)`
  - `ProposalApproved(address proposer)` / `ProposalRemoved(address proposer)` (allowlist changes)

- Invariants and Notes:
  - Proposals are opened with `active=true` and only closed once.
  - Ties leave `approved=false` because the check is strictly `yesVotes > noVotes`.
  - One-vote-per-address enforced via `hasVoted`; this does not prevent Sybil voting.
  - Anyone can vote and anyone can close; add gating if your use case requires.

## Development

Prerequisites:

- Foundry installed: https://book.getfoundry.sh/getting-started/installation

Common commands (run inside `proposal-contract/`):

```bash
forge install
forge build
forge test -vvv
```

Optional utilities:

```bash
forge fmt          # format
forge snapshot     # gas report
anvil              # local dev chain
```

## Deployment (Base Sepolia)

You need a funded account on Base Sepolia and an RPC URL, e.g. `https://sepolia.base.org`.

```bash
export RPC_URL="https://sepolia.base.org"
export PRIVATE_KEY="0xYOUR_PRIVATE_KEY"   # Use a secure method in real projects

forge create src/VotingContract.sol:VotingContract \
  --rpc-url "$RPC_URL" \
  --private-key "$PRIVATE_KEY"
```

Record the deployed address and configure the frontend with it.

## Interacting with cast (examples)

```bash
# Read proposal count
cast call <CONTRACT_ADDRESS> "getProposalCount()(uint256)" --rpc-url $RPC_URL

# Create a proposal (as approved proposer)
cast send <CONTRACT_ADDRESS> "createProposal(string,uint256)" "Upgrade treasury policy" 3600 \
  --private-key $PRIVATE_KEY --rpc-url $RPC_URL

# Vote yes on proposal 0
cast send <CONTRACT_ADDRESS> "vote(uint256,bool)" 0 true --private-key $PRIVATE_KEY --rpc-url $RPC_URL

# Close after deadline
cast send <CONTRACT_ADDRESS> "closeProposal(uint256)" 0 --private-key $PRIVATE_KEY --rpc-url $RPC_URL
```

---

## Documentation

https://book.getfoundry.sh/

## Usage

### Build

```shell
$ forge build
```

### Test

```shell
$ forge test
```

### Format

```shell
$ forge fmt
```

### Gas Snapshots

```shell
$ forge snapshot
```

### Anvil

```shell
$ anvil
```

### Deploy

```shell
$ forge script script/Counter.s.sol:CounterScript --rpc-url <your_rpc_url> --private-key <your_private_key>
```

### Cast

```shell
$ cast <subcommand>
```

### Help

```shell
$ forge --help
$ anvil --help
$ cast --help
```
